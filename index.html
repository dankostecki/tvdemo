<!DOCTYPE html>
<html lang="pl" class="dark">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>TradingView Data Service</title>
  <!-- TailwindCSS CDN -->
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- Material Icons -->
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet" />
  <!-- Lightweight Charts -->
  <script src="https://unpkg.com/lightweight-charts/dist/lightweight-charts.standalone.production.js"></script>
  <!-- Twoja data.js -->
  <script src="data.js"></script>
</head>
<body class="bg-gray-100 text-gray-900 dark:bg-gray-900 dark:text-gray-100">
  <!-- Navbar -->
  <nav class="flex items-center justify-between p-4 bg-white dark:bg-gray-800 shadow-md">
    <h1 class="text-xl font-semibold">ðŸ“ˆ TradingView Chart</h1>
    <div class="flex items-center space-x-3">
      <button id="lineBtn"       class="px-3 py-1 rounded hover:bg-gray-200 dark:hover:bg-gray-700">Linia</button>
      <button id="candleBtn"     class="px-3 py-1 rounded hover:bg-gray-200 dark:hover:bg-gray-700">Åšwiece</button>
      <button id="areaBtn"       class="px-3 py-1 rounded hover:bg-gray-200 dark:hover:bg-gray-700">Obszar</button>
      <button id="histogramBtn"  class="px-3 py-1 rounded hover:bg-gray-200 dark:hover:bg-gray-700">Histogram</button>
      <label class="flex items-center space-x-1 px-3 py-1 rounded hover:bg-gray-200 dark:hover:bg-gray-700">
        <span class="material-icons">percent</span>
        <input type="checkbox" id="percentScale" />
      </label>
      <select id="timeframe" class="px-3 py-1 bg-white dark:bg-gray-800 rounded hover:bg-gray-200 dark:hover:bg-gray-700">
        <option value="all">Wszystko</option>
        <option value="1y">1 rok</option>
        <option value="5y">5 lat</option>
      </select>
      <button id="themeToggle" class="px-3 py-1 rounded hover:bg-gray-200 dark:hover:bg-gray-700">
        <span class="material-icons" id="themeIcon">dark_mode</span>
      </button>
    </div>
  </nav>

  <!-- Chart -->
  <div id="chart" class="m-4 bg-white dark:bg-gray-800 rounded-lg shadow-lg" style="height: calc(100vh - 88px);"></div>

  <script>
    const chart = LightweightCharts.createChart(document.getElementById('chart'), {
      layout: {
        backgroundColor: getComputedStyle(document.body).getPropertyValue('--tw-bg-opacity') === '1' ? getComputedStyle(document.body).backgroundColor : '#1f2937',
        textColor: getComputedStyle(document.body).getPropertyValue('--tw-text-opacity') === '1' ? getComputedStyle(document.body).color : '#f3f4f6'
      },
      rightPriceScale: { mode: LightweightCharts.PriceScaleMode.Normal },
      crosshair: { mode: LightweightCharts.CrosshairMode.Normal },
      localization: { dateFormat: 'yyyy-MM-dd' },
    });

    // DomyÅ›lnie sÃ©rie liniowa
    let series = chart.addLineSeries({ color: '#3b82f6' });
    series.setData(data);

    // Helpers
    function resetSeries(type) {
      chart.removeSeries(series);
      switch(type) {
        case 'candle': series = chart.addCandlestickSeries(); break;
        case 'area':   series = chart.addAreaSeries({
                          topColor: 'rgba(59,130,246,0.5)',
                          bottomColor: 'rgba(59,130,246,0.1)',
                          lineColor: '#3b82f6'
                        }); break;
        case 'hist':   series = chart.addHistogramSeries({ priceFormat: { type: 'volume' } }); break;
        default:       series = chart.addLineSeries({ color: '#3b82f6' });
      }
      series.setData(data);
      applyScale();
      applyTimeframe();
    }
    function applyScale() {
      const pct = document.getElementById('percentScale').checked;
      chart.applyOptions({ rightPriceScale: { mode: pct ? LightweightCharts.PriceScaleMode.Percentage : LightweightCharts.PriceScaleMode.Normal } });
    }
    function applyTimeframe() {
      const val = document.getElementById('timeframe').value;
      if (val === 'all') return chart.timeScale().fitContent();
      const yrs = parseInt(val);
      const now = Math.floor(Date.now()/1000);
      const from = new Date(); from.setFullYear(from.getFullYear() - yrs);
      chart.timeScale().setVisibleRange({ from: Math.floor(from.getTime()/1000), to: now });
    }

    // Eventy przyciskÃ³w
    document.getElementById('lineBtn').onclick      = () => resetSeries('line');
    document.getElementById('candleBtn').onclick    = () => resetSeries('candle');
    document.getElementById('areaBtn').onclick      = () => resetSeries('area');
    document.getElementById('histogramBtn').onclick = () => resetSeries('hist');
    document.getElementById('percentScale').onchange = applyScale;
    document.getElementById('timeframe').onchange    = applyTimeframe;
    document.getElementById('themeToggle').onclick  = () => {
      document.body.classList.toggle('dark');
      const icon = document.getElementById('themeIcon');
      icon.textContent = document.body.classList.contains('dark') ? 'light_mode' : 'dark_mode';
      chart.applyOptions({
        layout: {
          backgroundColor: getComputedStyle(document.body).backgroundColor,
          textColor: getComputedStyle(document.body).color
        }
      });
    };

    // Dopasuj zakres przy starcie
    chart.timeScale().fitContent();
  </script>
</body>
</html>
